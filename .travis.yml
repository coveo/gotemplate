sudo: false

language: go

go:
  - 1.12.x

env:
- GO111MODULE=on

before_install:
  - go get github.com/mattn/goveralls

install:
  - make install

before_script:
  - make doc
  - if [[ `git status --porcelain` ]]; then
      echo "'make doc' was not run before commiting";
      exit 1;
    fi
  - go test ./...

script:
  - if [ "${TRAVIS_TAG::1}" = "v" ]; then
      curl -sL https://git.io/goreleaser | bash;
    fi

after_success:
  - make coveralls

notifications:
  email: false
